ik_node:
  ros__parameters:
    planning:
      # ========== 机械臂配置 ==========
      dof: 7
      urdf_path: "/home/agx/price/issac-sim/zongzhuang2/urdf/zongzhuang2.urdf"
      tip_link: "Link7"
      gripper_offset_z: 0.35

      # ========== 控制模式 ==========
      input_type: "xyz"
      ik_solver_type: "official_3d"

      # ========== IK 求解参数 ==========
      ik_max_iterations: 200
      ik_epsilon: 0.0001
      ik_epsilon_relaxed_3d: 0.005
      ik_epsilon_relaxed_6d: 0.01
      ik_damping_3d: 1e-12
      ik_damping_6d: 1e-4
      ik_step_size: 1.0

      # ========== 轨迹约束 ==========
      max_velocity: 1.0
      max_acceleration: 2.0
      max_jerk: 5.0
      control_frequency: 50.0

      # ========== 关节限位 ==========
      joint_limits_min: [-2.96, -2.18, -2.96, -3.13, -2.96, -1.83, -1.83]
      joint_limits_max: [2.96, 0.2, 2.96, 0.0, 2.96, 1.83, 1.83]

      # ========== IK / SVD / LM 扩展参数 ==========
      use_svd_damped: true                # 是否使用 SVD 阻尼伪逆
      ik_svd_damping: 1e-8                # 初始阻尼基数（会乘以 smax^2）
      ik_svd_damping_min: 1e-18
      ik_svd_damping_max: 1e6
      ik_svd_damping_reduce_factor: 0.5
      ik_svd_damping_increase_factor: 1.5   # 减缓阻尼放大速度，避免指数级增加
      ik_svd_trunc_tol: 1e-6              # 与最大奇异值的相对截断阈值
      ik_svd_min_rel_reduction: 1e-10     # 更宽容，允许更小的相对下降被接受
      publish_pose_pos_deadband: 1e-2
      publish_pose_ang_deadband: 1e-3
      publish_deadband: 1e-4

      # ========== 线搜索 / 步长 / 限幅 ==========
      ik_line_search_factors: [1.0, 0.5, 0.25, 0.125]
      max_delta: 0.05                      # 允许的更大整体步长
      max_delta_linear_scale: 0.05         # 增加线性分量尺度，允许更大位移步长
      max_delta_angular_scale: 0.05        # 增加角度分量尺度
      max_delta_min: 0.005
      nullspace_penalty_scale: 1e-2

      # ========== 权重 / 尺度 ==========
      pos_weight: 1.0
      ang_weight: 1.0
      joint_scale: [1, 1, 1, 1, 1, 1, 1]

      # ========== 退路 / 备用策略 ==========
      gradient_fallback_enable: true
      gradient_fallback_alpha: 0.02
      accept_best_within_tol: true
      accept_best_tol: 1e-10

      # ========== 收敛 / 迭代控制 ==========
      ik_accept_rel_decrease: 1e-6
      use_numeric_jacobian: true

      # ========== 日志 / 诊断 ==========
      log_to_file: false
      # log_file: "/home/agx/price/je_software/log/ik_log.log"
      # svd_q_log_file: "/home/agx/price/je_software/log/ik_svd.log"
      # diagnostics_log_file: "/home/agx/price/je_software/log/ik_diagnostics.log"
      # nullspace_log_file: "/home/agx/price/je_software/log/nullspace_log_file.log"
      log_level: info
      log_svd_values: false
      log_fk_each_iter: false

      # ========== 自适应 / 保守措施 ==========
      consecutive_shrink_after: 3
      consecutive_max_damping_rejections_limit: 10

      # ========== 其它 ==========
      publish_debug_markers: false
      fk_publish_rate: 10.0
